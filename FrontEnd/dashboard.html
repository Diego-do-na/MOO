<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>IoT Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { color: #1e88e5; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        .controls { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9; }
        .controls label { font-weight: bold; margin-right: 10px; }
        .controls select { padding: 8px; border-radius: 4px; border: 1px solid #aaa; }
        .controls button { padding: 8px 15px; background-color: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        .controls button:hover { background-color: #43a047; }
        
        .card { border: 1px solid #ddd; border-radius: 6px; padding: 20px; margin-bottom: 20px; background-color: #ffffff; }
        .card-header { background-color: #1e88e5; color: white; padding: 10px; margin: -20px -20px 20px -20px; border-top-left-radius: 6px; border-top-right-radius: 6px; font-size: 1.2em; }
        .card p { margin: 5px 0; }
        .card strong { display: inline-block; width: 120px; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>⚙️ IoT Dashboard Interactivo</h1>

    <div class="controls">
        <label for="device_selector">Seleccionar Dispositivo:</label>
        <select id="device_selector">
            <option value="all">Todos</option>
        </select>
        <button onclick="loadDashboard()">Mostrar</button>
    </div>

    <h2 id="title"></h2>
    <div class="results" id="results"></div>
</div>

<script>
const BACKEND_URL = "https://TU-BACKEND.com";

// Cargar lista de sensores
fetch(`${BACKEND_URL}/devices`)
    .then(res => res.json())
    .then(data => {
        const selector = document.getElementById("device_selector");

        data.devices.forEach(id => {
            const option = document.createElement("option");
            option.value = id;
            option.textContent = `Sensor ${id}`;
            selector.appendChild(option);
        });
    });

function loadDashboard() {
    const selected = document.getElementById("device_selector").value;
    const resultsDiv = document.getElementById("results");
    const title = document.getElementById("title");

    resultsDiv.innerHTML = "";

    if (selected === "all") {
        title.textContent = "Resultados: Todos los sensores";

        fetch(`${BACKEND_URL}/dashboard/all`)
            .then(res => res.json())
            .then(data => {
                const grid = document.createElement("div");
                grid.className = "card-grid";

                for (let device_id in data) {
                    const info = data[device_id];
                    const card = renderCard(device_id, info);
                    grid.appendChild(card);
                }
                resultsDiv.appendChild(grid);
            });

    } else {
        title.textContent = `Resultados: Sensor ${selected}`;

        fetch(`${BACKEND_URL}/dashboard/${selected}`)
            .then(res => res.json())
            .then(data => {
                const card = renderCard(selected, data);
                resultsDiv.appendChild(card);
            });
    }
}

function renderCard(device_id, data) {
    const card = document.createElement("div");
    card.className = "card";

    if (data.error) {
        card.style.borderColor = "red";
        card.innerHTML = `
            <div class="card-header" style="background-color: #d32f2f;">
                Sensor ${device_id} (ERROR)
            </div>
            <p><strong>Error:</strong> ${data.error}</p>
        `;
    } else {
        card.innerHTML = `
            <div class="card-header">Sensor ${device_id}</div>
            <p><strong>ID:</strong> ${data.sensor_id}</p>
            <p><strong>Último Valor:</strong> ${data.latest_value}</p>
            <p><strong>Última Lectura:</strong> ${data.latest_timestamp}</p>
            <p><strong>Total de Lecturas:</strong> ${data.total_readings}</p>
        `;
    }

    return card;
}
</script>

</body>
</html>